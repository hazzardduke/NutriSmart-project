<h2>Administrar Usuarios</h2>

<table class="clients-table">
  <thead>
    <tr>
      <th>Nombre</th>
      <th>Correo</th>
      <th>Rol</th>
      <th>Activo</th>
      <th>Acciones</th>
    </tr>
  </thead>

  <tbody>
    <tr *ngFor="let u of users$ | async">
      <td>{{ u.nombre }}</td>
      <td>{{ u.correo }}</td>
      <td>
        <select
          #roleSel
          [ngModel]="u.role"
          (ngModelChange)="onRoleChange(u, $event, roleSel)"
          class="role-select"
        >
          <option *ngFor="let r of roles" [value]="r">{{ r }}</option>
        </select>
      </td>
      <td class="col-active">
        <input
          type="checkbox"
          [checked]="u.active"
          (change)="onToggleActive(u)"
        />
      </td>
      <td>
        <button
          type="button"
          class="btn-action edit"
          (click)="onEdit(u)"
        >
          <i class="fas fa-edit"></i> Editar
        </button>
      </td>
    </tr>
  </tbody>
</table>

<div *ngIf="editForm.get('uid')!.value" class="edit-panel">
  <h3>Editar Usuario</h3>

  <form [formGroup]="editForm" (ngSubmit)="saveEdit()" class="edit-form">
    <div class="field">
      <label for="nombre">Nombre:</label>
      <input id="nombre" type="text" formControlName="nombre" />
    </div>

    <div class="field">
      <label for="telefono">Tel√©fono:</label>
      <input id="telefono" type="text" formControlName="telefono" />
    </div>

    <div class="field">
      <label for="correo">Correo:</label>
      <input id="correo" type="email" formControlName="correo" />
    </div>

    <div class="field">
      <label for="role">Rol:</label>
      <select id="role" formControlName="role">
        <option *ngFor="let r of roles" [value]="r">{{ r }}</option>
      </select>
    </div>

    <div class="field-active">
      <label for="active">Activo:</label>
      <input id="active" type="checkbox" formControlName="active" />
    </div>

    <div class="form-actions">
      <button type="submit" class="btn-action save">
        <i class="fas fa-save"></i> Guardar
      </button>
    </div>
  </form>
</div>
