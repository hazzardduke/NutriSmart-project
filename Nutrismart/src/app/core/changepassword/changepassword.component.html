<div class="cp-card" [class.loading]="loading()">
  <h1>Cambiar contraseña</h1>

  <form [formGroup]="form" (ngSubmit)="onSubmit()" novalidate>
    <!-- Contraseña actual -->
    <div class="field">
      <label for="currentPassword">Contraseña actual</label>
      <div class="password-input">
        <input
          id="currentPassword"
          [type]="showCurrent() ? 'text' : 'password'"
          formControlName="currentPassword"
          autocomplete="current-password"
          placeholder="Ingresa tu contraseña actual" />
        <button type="button" class="toggle" (click)="toggle('current')">
          {{ showCurrent() ? 'Ocultar' : 'Mostrar' }}
        </button>
      </div>
      <small class="error" *ngIf="f['currentPassword'].touched && f['currentPassword'].invalid">
        La contraseña actual es obligatoria (mínimo 6 caracteres).
      </small>
    </div>

    <!-- Nueva contraseña -->
    <div class="field">
      <label for="newPassword">Nueva contraseña</label>
      <div class="password-input">
        <input
          id="newPassword"
          [type]="showNew() ? 'text' : 'password'"
          formControlName="newPassword"
          autocomplete="new-password"
          placeholder="Nueva contraseña" />
        <button type="button" class="toggle" (click)="toggle('new')">
          {{ showNew() ? 'Ocultar' : 'Mostrar' }}
        </button>
      </div>
      <small class="hint">Mínimo 8 caracteres. Recomendado: mayúscula, minúscula y número.</small>
      <small class="error" *ngIf="f['newPassword'].touched && f['newPassword'].invalid">
        La nueva contraseña no cumple los requisitos.
      </small>
    </div>

    <!-- Confirmar nueva -->
    <div class="field">
      <label for="confirmNewPassword">Confirmar nueva contraseña</label>
      <div class="password-input">
        <input
          id="confirmNewPassword"
          [type]="showConfirm() ? 'text' : 'password'"
          formControlName="confirmNewPassword"
          autocomplete="new-password"
          placeholder="Confirmar nueva contraseña" />
        <button type="button" class="toggle" (click)="toggle('confirm')">
          {{ showConfirm() ? 'Ocultar' : 'Mostrar' }}
        </button>
      </div>
      <small class="error" *ngIf="passwordMismatch()">
        Las contraseñas no coinciden.
      </small>
    </div>

    <button class="btn-primary"
            type="submit"
            [disabled]="form.invalid || loading()">
      {{ loading() ? 'Actualizando…' : 'Actualizar contraseña' }}
    </button>
  </form>

  <div class="overlay" *ngIf="loading()">
    <div class="spinner"></div>
  </div>
</div>
